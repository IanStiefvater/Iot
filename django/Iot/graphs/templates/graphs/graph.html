{% load filter %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos de producción</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {packages: ['corechart', 'bar']});
      google.charts.setOnLoadCallback(drawCharts);

      function drawCharts() {
        const results = {{ results|safe }};
        console.log(results);

        
        
        for (const result of results) {
          const line_id = result.line_id;
          const devices_data = result.devices_data;

          const data = new google.visualization.DataTable();
          data.addColumn('string', 'Device');
          data.addColumn('number', 'Producción Total');
          data.addColumn('number', 'Producción Potencial');
          data.addColumn({ role: 'annotation', type: 'string' });

          for (const device_data of devices_data) {
            data.addRow([device_data.device_name, device_data.total_production, device_data.potential_production, '']);
          }
          const options = {
            width: 1000,
            height: 600,
            legend: { position: 'top', maxLines: 3 },
            bar: { groupWidth: '75%' },
            isStacked: true,
            // Cambiar la orientación de las barras
            hAxis: { title: 'Dispositivos' },
            vAxis: { title: 'Unidades' },
            colors: ['#D97C05', '#FFBE6C'],
          };

          // Cambiar el tipo de gráfico a ColumnChart
          const chart = new google.visualization.ColumnChart(document.getElementById(`chart_div_${line_id}`));
          chart.draw(data, options);
        }
      }
    </script>
    <style>
      li {
        list-style-type: none;
      }
      ul {
        margin: 0px;
        padding: 0px;
        width: 100%;
      }
      li {
        display:flex;
        align-items:center;
      }
      li a:hover {
        background-color: #252525;
      }
      #hola:hover {
        background-color: #252525;
      }
    </style>
</head>
<body>
<header style="width: 100%; height: 100px; background-color: #404040; flex-direction: column !important" >
  <ul class="d-flex" style="height:100%">
    <li class="col-6">
      <h1 class="ms-5" style="color:white; text-align:center">Panel</h1>
    </li>
    <li class="col-2" style="cursor:pointer; border-left: 1px solid white">
      <a href="desempeño" target="blank" class="col-12 button d-flex justify-content-center align-items-center" style="text-decoration:none; color: white; height:100%; font-size: 25px">Desempeño</a>
    </li>
    <li id="hola" class="col-2 d-flex justify-content-center align-items-center" style="cursor:pointer; border-left: 1px solid white; font-size:25px; color:white; text-align:center" data-bs-toggle="modal" data-bs-target="#dateModal">Seguimiento
    </li>
    <li class="col-2 d-flex align-items-center" style="cursor:pointer; border-left: 1px solid white">
      <a href="../linemanagement/select" class="col-12 button d-flex justify-content-center align-items-center" style="text-decoration:none; color: white; height:100%; font-size: 25px">Salir<span class="material-symbols-outlined" style="margin-left: 0.75rem">logout</span></a>
    </li>
  </ul>
</header>
 <!-- Modal -->
  <div class="modal fade" id="dateModal" tabindex="-1" aria-labelledby="dateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dateModalLabel">Elegir Fecha</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="date" id="dateInput" class="form-control">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" id="saveDate">Guardar</button>
        </div>
      </div>
    </div>
  </div>
  

  <div class="py-5" style="width:100%">
    {% for line_data in results %}
        <div class="d-flex align-items-center justify-content-center" style="flex-direction:column">
          <div class="col-6 text-center mx-auto card mb-2" style="background-color: #0d3f70;border-radius:10px; box-shadow: 0 0 4px 0 rgba(0,0,0,.14), 0 3px 4px 0 rgba(0,0,0,.12), 0 1px 5px 0 rgba(0,0,0,.2);"><h2 style="margin-top:0.5rem; color:white">Línea {{line_data.line_id}}</h2></div>
          <div class="mx-auto mb-3 d-flex column justify-content-center col-8" id="chart_div_{{ line_data.line_id }}" style="width: 100%; height: 600px;"></div>
        </div>
    {% endfor %}
  </div>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Cuando se haga click en 'Guardar'
    document.getElementById('saveDate').addEventListener('click', function () {
      // Obtener la fecha del input
      var date = document.getElementById('dateInput').value;

      // Imprimir la fecha en la consola (o hacer lo que quieras con ella)
      console.log(date);

      // Cerrar el modal
      var modalElement = document.getElementById('dateModal')
      var modal = bootstrap.Modal.getInstance(modalElement)
      modal.hide()
    });
  </script>
</body>

</html>
